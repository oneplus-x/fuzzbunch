NSA Finest Tool

Running Fuzzbunch on Kali Through a Meterpreter Port Forward
Eternalblue and the rest of the Windows exploits released by the Equation Group are built to run on Windows, not Linux. While there are people working hard to <a href="https://github.com/RiskSense-Ops/MS17-010" data-href="https://github.com/RiskSense-Ops/MS17-010" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">port the exploits over to Metasploit</a>, currently the only supported versions are x64 Windows7 and Windows 2008R2, whereas the actual Eternalblue exploit in the Equation Group leak can exploit x86 versions of 7/2008 and XP.</p><p name="0313" id="0313" class="graf graf--p graf-after--p">The Equation Group leak has been ported to Linux via wine and this new Linux friendly version can be downloaded here — <a href="https://github.com/mdiazcl/fuzzbunch-debian" data-href="https://github.com/mdiazcl/fuzzbunch-debian" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener" target="_blank">https://github.com/mdiazcl/fuzzbunch-debian</a>. Fuzzbunch is the name of the framework used that contains Eternalblue, Doublepulsar and several other exploits. I won’t go through the setup in this post since the readme in the github repo does a great job of explaining how to get this running on Kali.</p><p name="213a" id="213a" class="graf graf--p graf-after--p">In my previous post I went over how to attack internal hosts through a meterpreter session using Metasploit’s socks4a proxy services. This technique works great for most of the network based scanning and attack tools in Kali but was not effective for fuzzbunch in wine.</p><p name="d890" id="d890" class="graf graf--p graf-after--p">Another pivoting option that Metasploit offers is portfwd. Once you establish a meterpreter shell to an internal machine you can forward individual ports directly to internal hosts. The attacker machine will start listening on the port specified, with that port being bound to the running metasploit instance, which in turn forwards the traffic through the meterpreter session to whatever destination IP is defined in the portfwd command.</p><p name="70e7" id="70e7" class="graf graf--p graf-after--p">In this scenario we have the attacker -10.0.0.35 on one side of the firewall with an established meterpreter session to 192.168.55.100.</p><figure name="c71c" id="c71c" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 549px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 78.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image" data-image-id="1*YWkR0KDY3TLvNwlGoF0s9w.png" data-width="821" data-height="644" data-action="zoom" data-action-value="1*YWkR0KDY3TLvNwlGoF0s9w.png"><img src="https://cdn-images-1.medium.com/freeze/max/30/1*YWkR0KDY3TLvNwlGoF0s9w.png?q=20" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/1*YWkR0KDY3TLvNwlGoF0s9w.png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/800/1*YWkR0KDY3TLvNwlGoF0s9w.png"></noscript></div></div><figcaption class="imageCaption">Visio Depicting the Network Layout of the Scenario</figcaption></figure><p name="11de" id="11de" class="graf graf--p graf-after--figure">Once the pivot host’s externally facing service is compromised and a meterpreter shell is achieved, we need to configure portfwd to relay traffic to internal hosts. The command in this case would be:</p><pre name="9971" id="9971" class="graf graf--pre graf-after--p">portfwd add -l 9000 -p 445 -r 192.168.55.65</pre><p name="55a2" id="55a2" class="graf graf--p graf-after--pre">The breakdown of the command is like this:</p><p name="bebc" id="bebc" class="graf graf--p graf--startsWithDoubleQuote graf-after--p">“-l 9000” : The port that will receive the traffic on the attacker host</p><p name="c32b" id="c32b" class="graf graf--p graf--startsWithDoubleQuote graf-after--p">“-p 445” : The port on the internal victim that will be accessed</p><p name="6e0f" id="6e0f" class="graf graf--p graf--startsWithDoubleQuote graf-after--p">“ -r 192.168.55.65” : The internal victim</p>
